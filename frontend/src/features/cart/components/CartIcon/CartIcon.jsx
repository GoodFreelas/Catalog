import React, { useState, useEffect } from "react";

const AnimatedCart = ({ size = 200, className = "", simplified = null }) => {
  const [isMobile, setIsMobile] = useState(false);

  useEffect(() => {
    // Detecta se é mobile
    const checkMobile = () => {
      const userAgent = navigator.userAgent.toLowerCase();
      const mobileKeywords = [
        "android",
        "iphone",
        "ipad",
        "ipod",
        "blackberry",
        "windows phone",
      ];
      const isMobileUserAgent = mobileKeywords.some((keyword) =>
        userAgent.includes(keyword)
      );
      const isTouchDevice = "ontouchstart" in window;
      const isSmallScreen = window.innerWidth <= 768;

      return isMobileUserAgent || (isTouchDevice && isSmallScreen);
    };

    setIsMobile(checkMobile());

    // Listener para mudanças de tamanho da tela
    const handleResize = () => {
      setIsMobile(checkMobile());
    };

    window.addEventListener("resize", handleResize);
    return () => window.removeEventListener("resize", handleResize);
  }, []);

  // Usa a prop simplified se fornecida, senão usa a detecção automática
  const shouldSimplify = simplified !== null ? simplified : isMobile;

  // Versão simplificada para mobile (sem animações)
  if (shouldSimplify) {
    return (
      <svg
        width={size}
        height={size + 6}
        viewBox="0 0 59 61"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        className={`inline-block ${className}`}
      >
        <defs>
          {/* Padrão de listras sem animação */}
          <pattern
            id="flagStripesStatic"
            x="0"
            y="0"
            width="90"
            height="100"
            patternUnits="userSpaceOnUse"
          >
            <g transform="skewX(-15)">
              <rect x="-10" y="-10" width="30" height="120" fill="#FECB00" />
              <rect x="20" y="-10" width="30" height="120" fill="#C80F2E" />
              <rect x="50" y="-10" width="30" height="120" fill="#006336" />
              <rect x="80" y="-10" width="30" height="120" fill="#FECB00" />
              <rect x="110" y="-10" width="30" height="120" fill="#C80F2E" />
              <rect x="140" y="-10" width="30" height="120" fill="#006336" />
            </g>
          </pattern>

          <linearGradient
            id="volumeGradientStatic"
            x1="0%"
            y1="0%"
            x2="100%"
            y2="100%"
          >
            <stop offset="0%" stopColor="rgba(255,255,255,0.2)" />
            <stop offset="100%" stopColor="rgba(0,0,0,0.1)" />
          </linearGradient>
        </defs>

        {/* Forma principal do carrinho */}
        <path
          d="M2.69318 0.767914C2.03014 0.767914 1.39425 1.03131 0.92541 1.50015C0.456569 1.96899 0.193176 2.60487 0.193176 3.26791C0.193176 3.93096 0.456569 4.56684 0.92541 5.03568C1.39425 5.50452 2.03014 5.76791 2.69318 5.76791H3.92318C4.46603 5.76885 4.99383 5.94647 5.42681 6.27391C5.8598 6.60135 6.17443 7.06083 6.32318 7.58291L14.2532 35.3329C14.7017 36.8989 15.6479 38.2764 16.9487 39.2569C18.2495 40.2375 19.8342 40.7679 21.4632 40.7679H44.3082C45.8074 40.7682 47.2723 40.3191 48.5138 39.4786C49.7553 38.6382 50.7165 37.445 51.2732 36.0529L58.6432 17.6229C58.9462 16.8645 59.0588 16.0435 58.9712 15.2316C58.8836 14.4196 58.5984 13.6415 58.1406 12.9652C57.6829 12.2889 57.0664 11.735 56.3452 11.352C55.6239 10.969 54.8198 10.7684 54.0032 10.7679H12.4332L11.1282 6.20791C10.6808 4.64178 9.73576 3.26384 8.43588 2.2824C7.136 1.30095 5.55196 0.769336 3.92318 0.767914H2.69318ZM22.6932 60.7679C23.6781 60.7679 24.6534 60.5739 25.5633 60.197C26.4732 59.8201 27.3 59.2677 27.9965 58.5712C28.6929 57.8748 29.2454 57.048 29.6223 56.138C29.9992 55.2281 30.1932 54.2528 30.1932 53.2679C30.1932 52.283 29.9992 51.3077 29.6223 50.3978C29.2454 49.4878 28.6929 48.6611 27.9965 47.9646C27.3 47.2682 26.4732 46.7157 25.5633 46.3388C24.6534 45.9619 23.6781 45.7679 22.6932 45.7679C20.7041 45.7679 18.7964 46.5581 17.3899 47.9646C15.9834 49.3711 15.1932 51.2788 15.1932 53.2679C15.1932 55.257 15.9834 57.1647 17.3899 58.5712C18.7964 59.9777 20.7041 60.7679 22.6932 60.7679ZM42.6932 60.7679C43.6781 60.7679 44.6534 60.5739 45.5633 60.197C46.4732 59.8201 47.3 59.2677 47.9965 58.5712C48.6929 57.8748 49.2454 57.048 49.6223 56.138C49.9992 55.2281 50.1932 54.2528 50.1932 53.2679C50.1932 52.283 49.9992 51.3077 49.6223 50.3978C49.2454 49.4878 48.6929 48.6611 47.9965 47.9646C47.3 47.2682 46.4732 46.7157 45.5633 46.3388C44.6534 45.9619 43.6781 45.7679 42.6932 45.7679C40.7041 45.7679 38.7964 46.5581 37.3899 47.9646C35.9834 49.3711 35.1932 51.2788 35.1932 53.2679C35.1932 55.257 35.9834 57.1647 37.3899 58.5712C38.7964 59.9777 40.7041 60.7679 42.6932 60.7679Z"
          fill="url(#flagStripesStatic)"
          stroke="rgba(255,255,255,0.8)"
          strokeWidth="0.5"
        />

        {/* Camada de volume */}
        <path
          d="M2.69318 0.767914C2.03014 0.767914 1.39425 1.03131 0.92541 1.50015C0.456569 1.96899 0.193176 2.60487 0.193176 3.26791C0.193176 3.93096 0.456569 4.56684 0.92541 5.03568C1.39425 5.50452 2.03014 5.76791 2.69318 5.76791H3.92318C4.46603 5.76885 4.99383 5.94647 5.42681 6.27391C5.8598 6.60135 6.17443 7.06083 6.32318 7.58291L14.2532 35.3329C14.7017 36.8989 15.6479 38.2764 16.9487 39.2569C18.2495 40.2375 19.8342 40.7679 21.4632 40.7679H44.3082C45.8074 40.7682 47.2723 40.3191 48.5138 39.4786C49.7553 38.6382 50.7165 37.445 51.2732 36.0529L58.6432 17.6229C58.9462 16.8645 59.0588 16.0435 58.9712 15.2316C58.8836 14.4196 58.5984 13.6415 58.1406 12.9652C57.6829 12.2889 57.0664 11.735 56.3452 11.352C55.6239 10.969 54.8198 10.7684 54.0032 10.7679H12.4332L11.1282 6.20791C10.6808 4.64178 9.73576 3.26384 8.43588 2.2824C7.136 1.30095 5.55196 0.769336 3.92318 0.767914H2.69318ZM22.6932 60.7679C23.6781 60.7679 24.6534 60.5739 25.5633 60.197C26.4732 59.8201 27.3 59.2677 27.9965 58.5712C28.6929 57.8748 29.2454 57.048 29.6223 56.138C29.9992 55.2281 30.1932 54.2528 30.1932 53.2679C30.1932 52.283 29.9992 51.3077 29.6223 50.3978C29.2454 49.4878 28.6929 48.6611 27.9965 47.9646C27.3 47.2682 26.4732 46.7157 25.5633 46.3388C24.6534 45.9619 23.6781 45.7679 22.6932 45.7679C20.7041 45.7679 18.7964 46.5581 17.3899 47.9646C15.9834 49.3711 15.1932 51.2788 15.1932 53.2679C15.1932 55.257 15.9834 57.1647 17.3899 58.5712C18.7964 59.9777 20.7041 60.7679 22.6932 60.7679ZM42.6932 60.7679C43.6781 60.7679 44.6534 60.5739 45.5633 60.197C26.4732 59.8201 47.3 59.2677 47.9965 58.5712C48.6929 57.8748 49.2454 57.048 49.6223 56.138C49.9992 55.2281 50.1932 54.2528 50.1932 53.2679C50.1932 52.283 49.9992 51.3077 49.6223 50.3978C49.2454 49.4878 48.6929 48.6611 47.9965 47.9646C47.3 47.2682 46.4732 46.7157 45.5633 46.3388C44.6534 45.9619 43.6781 45.7679 42.6932 45.7679C40.7041 45.7679 38.7964 46.5581 37.3899 47.9646C35.9834 49.3711 35.1932 51.2788 35.1932 53.2679C35.1932 55.257 35.9834 57.1647 37.3899 58.5712C38.7964 59.9777 40.7041 60.7679 42.6932 60.7679Z"
          fill="url(#volumeGradientStatic)"
          opacity="0.4"
        />

        {/* Rodas estáticas */}
        <circle
          cx="22.7"
          cy="53.3"
          r="7.5"
          fill="none"
          stroke="rgba(255,255,255,0.8)"
          strokeWidth="1.5"
        />
        <circle cx="22.7" cy="53.3" r="3" fill="rgba(255,255,255,0.6)" />

        <circle
          cx="42.7"
          cy="53.3"
          r="7.5"
          fill="none"
          stroke="rgba(255,255,255,0.8)"
          strokeWidth="1.5"
        />
        <circle cx="42.7" cy="53.3" r="3" fill="rgba(255,255,255,0.6)" />
      </svg>
    );
  }

  // Versão completa com animações
  return (
    <svg
      width={size}
      height={size + 6}
      viewBox="0 0 59 61"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
      className={`inline-block ${className}`}
    >
      <defs>
        {/* Padrão de listras animadas */}
        <pattern
          id="flagStripes"
          x="0"
          y="0"
          width="90"
          height="100"
          patternUnits="userSpaceOnUse"
        >
          <g transform="skewX(-15)">
            <rect x="-10" y="-10" width="30" height="120" fill="#FECB00" />
            <rect x="20" y="-10" width="30" height="120" fill="#C80F2E" />
            <rect x="50" y="-10" width="30" height="120" fill="#006336" />
            <rect x="80" y="-10" width="30" height="120" fill="#FECB00" />
            <rect x="110" y="-10" width="30" height="120" fill="#C80F2E" />
            <rect x="140" y="-10" width="30" height="120" fill="#006336" />
          </g>

          <animateTransform
            attributeName="patternTransform"
            type="translate"
            values="0 0; -90 0"
            dur="2s"
            repeatCount="indefinite"
          />
        </pattern>

        <linearGradient id="volumeGradient" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" stopColor="rgba(255,255,255,0.2)" />
          <stop offset="100%" stopColor="rgba(0,0,0,0.1)" />
        </linearGradient>
      </defs>

      {/* Forma principal do carrinho */}
      <path
        d="M2.69318 0.767914C2.03014 0.767914 1.39425 1.03131 0.92541 1.50015C0.456569 1.96899 0.193176 2.60487 0.193176 3.26791C0.193176 3.93096 0.456569 4.56684 0.92541 5.03568C1.39425 5.50452 2.03014 5.76791 2.69318 5.76791H3.92318C4.46603 5.76885 4.99383 5.94647 5.42681 6.27391C5.8598 6.60135 6.17443 7.06083 6.32318 7.58291L14.2532 35.3329C14.7017 36.8989 15.6479 38.2764 16.9487 39.2569C18.2495 40.2375 19.8342 40.7679 21.4632 40.7679H44.3082C45.8074 40.7682 47.2723 40.3191 48.5138 39.4786C49.7553 38.6382 50.7165 37.445 51.2732 36.0529L58.6432 17.6229C58.9462 16.8645 59.0588 16.0435 58.9712 15.2316C58.8836 14.4196 58.5984 13.6415 58.1406 12.9652C57.6829 12.2889 57.0664 11.735 56.3452 11.352C55.6239 10.969 54.8198 10.7684 54.0032 10.7679H12.4332L11.1282 6.20791C10.6808 4.64178 9.73576 3.26384 8.43588 2.2824C7.136 1.30095 5.55196 0.769336 3.92318 0.767914H2.69318ZM22.6932 60.7679C23.6781 60.7679 24.6534 60.5739 25.5633 60.197C26.4732 59.8201 27.3 59.2677 27.9965 58.5712C28.6929 57.8748 29.2454 57.048 29.6223 56.138C29.9992 55.2281 30.1932 54.2528 30.1932 53.2679C30.1932 52.283 29.9992 51.3077 29.6223 50.3978C29.2454 49.4878 28.6929 48.6611 27.9965 47.9646C27.3 47.2682 26.4732 46.7157 25.5633 46.3388C24.6534 45.9619 23.6781 45.7679 22.6932 45.7679C20.7041 45.7679 18.7964 46.5581 17.3899 47.9646C15.9834 49.3711 15.1932 51.2788 15.1932 53.2679C15.1932 55.257 15.9834 57.1647 17.3899 58.5712C18.7964 59.9777 20.7041 60.7679 22.6932 60.7679ZM42.6932 60.7679C43.6781 60.7679 44.6534 60.5739 45.5633 60.197C46.4732 59.8201 47.3 59.2677 47.9965 58.5712C48.6929 57.8748 49.2454 57.048 49.6223 56.138C49.9992 55.2281 50.1932 54.2528 50.1932 53.2679C50.1932 52.283 49.9992 51.3077 49.6223 50.3978C49.2454 49.4878 48.6929 48.6611 47.9965 47.9646C47.3 47.2682 46.4732 46.7157 45.5633 46.3388C44.6534 45.9619 43.6781 45.7679 42.6932 45.7679C40.7041 45.7679 38.7964 46.5581 37.3899 47.9646C35.9834 49.3711 35.1932 51.2788 35.1932 53.2679C35.1932 55.257 35.9834 57.1647 37.3899 58.5712C38.7964 59.9777 40.7041 60.7679 42.6932 60.7679Z"
        fill="url(#flagStripes)"
        stroke="rgba(255,255,255,0.8)"
        strokeWidth="0.5"
      />

      {/* Camada de volume */}
      <path
        d="M2.69318 0.767914C2.03014 0.767914 1.39425 1.03131 0.92541 1.50015C0.456569 1.96899 0.193176 2.60487 0.193176 3.26791C0.193176 3.93096 0.456569 4.56684 0.92541 5.03568C1.39425 5.50452 2.03014 5.76791 2.69318 5.76791H3.92318C4.46603 5.76885 4.99383 5.94647 5.42681 6.27391C5.8598 6.60135 6.17443 7.06083 6.32318 7.58291L14.2532 35.3329C14.7017 36.8989 15.6479 38.2764 16.9487 39.2569C18.2495 40.2375 19.8342 40.7679 21.4632 40.7679H44.3082C45.8074 40.7682 47.2723 40.3191 48.5138 39.4786C49.7553 38.6382 50.7165 37.445 51.2732 36.0529L58.6432 17.6229C58.9462 16.8645 59.0588 16.0435 58.9712 15.2316C58.8836 14.4196 58.5984 13.6415 58.1406 12.9652C57.6829 12.2889 57.0664 11.735 56.3452 11.352C55.6239 10.969 54.8198 10.7684 54.0032 10.7679H12.4332L11.1282 6.20791C10.6808 4.64178 9.73576 3.26384 8.43588 2.2824C7.136 1.30095 5.55196 0.769336 3.92318 0.767914H2.69318ZM22.6932 60.7679C23.6781 60.7679 24.6534 60.5739 25.5633 60.197C26.4732 59.8201 27.3 59.2677 27.9965 58.5712C28.6929 57.8748 29.2454 57.048 29.6223 56.138C29.9992 55.2281 30.1932 54.2528 30.1932 53.2679C30.1932 52.283 29.9992 51.3077 29.6223 50.3978C29.2454 49.4878 28.6929 48.6611 27.9965 47.9646C27.3 47.2682 26.4732 46.7157 25.5633 46.3388C24.6534 45.9619 23.6781 45.7679 22.6932 45.7679C20.7041 45.7679 18.7964 46.5581 17.3899 47.9646C15.9834 49.3711 15.1932 51.2788 15.1932 53.2679C15.1932 55.257 15.9834 57.1647 17.3899 58.5712C18.7964 59.9777 20.7041 60.7679 22.6932 60.7679ZM42.6932 60.7679C43.6781 60.7679 44.6534 60.5739 45.5633 60.197C46.4732 59.8201 47.3 59.2677 47.9965 58.5712C48.6929 57.8748 49.2454 57.048 49.6223 56.138C49.9992 55.2281 50.1932 54.2528 50.1932 53.2679C50.1932 52.283 49.9992 51.3077 49.6223 50.3978C49.2454 49.4878 48.6929 48.6611 47.9965 47.9646C47.3 47.2682 46.4732 46.7157 45.5633 46.3388C44.6534 45.9619 43.6781 45.7679 42.6932 45.7679C40.7041 45.7679 38.7964 46.5581 37.3899 47.9646C35.9834 49.3711 35.1932 51.2788 35.1932 53.2679C35.1932 55.257 35.9834 57.1647 37.3899 58.5712C38.7964 59.9777 40.7041 60.7679 42.6932 60.7679Z"
        fill="url(#volumeGradient)"
        opacity="0.4"
      />

      {/* Rodas com animação */}
      <g>
        <animateTransform
          attributeName="transform"
          type="rotate"
          values="0 22.7 53.3; 360 22.7 53.3"
          dur="2s"
          repeatCount="indefinite"
        />
        <circle
          cx="22.7"
          cy="53.3"
          r="7.5"
          fill="none"
          stroke="rgba(255,255,255,0.8)"
          strokeWidth="1.5"
        />
        <circle cx="22.7" cy="53.3" r="3" fill="rgba(255,255,255,0.6)" />
      </g>

      <g>
        <animateTransform
          attributeName="transform"
          type="rotate"
          values="0 42.7 53.3; 360 42.7 53.3"
          dur="2s"
          repeatCount="indefinite"
        />
        <circle
          cx="42.7"
          cy="53.3"
          r="7.5"
          fill="none"
          stroke="rgba(255,255,255,0.8)"
          strokeWidth="1.5"
        />
        <circle cx="42.7" cy="53.3" r="3" fill="rgba(255,255,255,0.6)" />
      </g>
    </svg>
  );
};

export default AnimatedCart;
